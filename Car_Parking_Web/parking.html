<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Parking System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/parking_modern.css">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-car"></i> FLAWLESS
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user"></i> <span id="username"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="showProfile()">Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Panel - Parking Map -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-map"></i> S∆° ƒë·ªì b√£i ƒë·ªó xe</h5>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshMap()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="toggleView()">
                                <i class="fas fa-eye"></i> 3D View
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="parking-map" class="parking-map">
                            <!-- VIP Label -->
                            <div class="vip-label">KHU VIP</div>
                            
                            <!-- VIP Parking Area -->
                            <div class="vip-area">
                                <div class="vip-spot empty" data-spot="V1">
                                    <div class="spot-label">V1</div>
                                    <div class="spot-status">Tr·ªëng</div>
                                    <div class="vip-car"></div>
                                </div>
                                <div class="vip-spot empty" data-spot="V2">
                                    <div class="spot-label">V2</div>
                                    <div class="spot-status">Tr·ªëng</div>
                                    <div class="vip-car"></div>
                                </div>
                                <div class="vip-spot empty" data-spot="V3">
                                    <div class="spot-label">V3</div>
                                    <div class="spot-status">Tr·ªëng</div>
                                    <div class="vip-car"></div>
                                </div>
                                <div class="vip-spot empty" data-spot="V4">
                                    <div class="spot-label">V4</div>
                                    <div class="spot-status">Tr·ªëng</div>
                                    <div class="vip-car"></div>
                                </div>
                            </div>
                            
                            <!-- Main Road -->
                            <div class="main-road">
                                <div class="road-car"></div>
                                <div class="road-car"></div>
                            </div>
                            
                            <!-- Entrance Gate -->
                            <div class="entrance-gate">
                                üöó C·ªîNG V√ÄO
                            </div>
                        </div>
                        
                        <!-- Legend -->
                        <div class="map-legend mt-3">
                            <div class="row">
                                <div class="col-auto">
                                    <span class="legend-item">
                                        <span class="legend-color empty"></span>
                                        <span>Tr·ªëng</span>
                                    </span>
                                </div>
                                <div class="col-auto">
                                    <span class="legend-item">
                                        <span class="legend-color reserved"></span>
                                        <span>ƒê√£ ƒë·∫∑t</span>
                                    </span>
                                </div>
                                <div class="col-auto">
                                    <span class="legend-item">
                                        <span class="legend-color occupied"></span>
                                        <span>C√≥ xe</span>
                                    </span>
                                </div>
                                <div class="col-auto">
                                    <span class="legend-item">
                                        <span class="legend-color processing"></span>
                                        <span>ƒêang x·ª≠ l√Ω</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Controls -->
            <div class="col-lg-4">
                <!-- User Status -->
                <div class="card mb-3">
                    <div class="card-header">
                        <h6><i class="fas fa-info-circle"></i> Tr·∫°ng th√°i c·ªßa b·∫°n</h6>
                    </div>
                    <div class="card-body" id="user-status">
                        <!-- User status will be displayed here -->
                    </div>
                </div>

                <!-- Reservation Form -->
                <div class="card mb-3" id="reservation-form-card">
                    <div class="card-header">
                        <h6><i class="fas fa-plus-circle"></i> ƒê·∫∑t ch·ªó ƒë·ªó xe</h6>
                    </div>
                    <div class="card-body">
                        <form id="reservation-form">
                            <div class="mb-3">
                                <label for="license-plate" class="form-label">Bi·ªÉn s·ªë xe</label>
                                <input type="text" class="form-control" id="license-plate" 
                                       placeholder="VD: 29A-12345" required 
                                       pattern="[0-9]{2}[A-Za-z]-[0-9]{4,5}">
                                <div class="form-text">Nh·∫≠p bi·ªÉn s·ªë xe c·ªßa b·∫°n</div>
                            </div>
                            <div class="mb-3">
                                <label for="selected-spot" class="form-label">Ch·ªó ƒë·ªó xe</label>
                                <input type="text" class="form-control" id="selected-spot" 
                                       placeholder="Ch·ªçn ch·ªó tr√™n s∆° ƒë·ªì" readonly>
                                <input type="hidden" id="selected-spot-id">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-parking"></i> ƒê·∫∑t ch·ªó
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card">
                    <div class="card-header">
                        <h6><i class="fas fa-chart-bar"></i> Th·ªëng k√™ b√£i ƒë·ªó</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="stat-item">
                                    <div class="stat-number" id="total-spots">0</div>
                                    <div class="stat-label">T·ªïng ch·ªó</div>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="stat-item">
                                    <div class="stat-number text-success" id="empty-spots">0</div>
                                    <div class="stat-label">C√≤n tr·ªëng</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="stat-item">
                                    <div class="stat-number text-warning" id="reserved-spots">0</div>
                                    <div class="stat-label">ƒê√£ ƒë·∫∑t</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="stat-item">
                                    <div class="stat-number text-danger" id="occupied-spots">0</div>
                                    <div class="stat-label">C√≥ xe</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notification-toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Th√¥ng b√°o</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-message"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/parking.js"></script>
    
    <!-- Initialize Parking System -->
    <script>
        // Fallback script n·∫øu file parking.js kh√¥ng load ƒë∆∞·ª£c
        document.addEventListener('DOMContentLoaded', function() {
            // VIP parking data
            const vipSpots = [
                { id: 'V1', status: 'empty', license_plate: null },
                { id: 'V2', status: 'occupied', license_plate: '29A-1234' },
                { id: 'V3', status: 'empty', license_plate: null },
                { id: 'V4', status: 'reserved', license_plate: '30B-5678' }
            ];
            
            // Update VIP spots display
            function updateVIPDisplay() {
                vipSpots.forEach(spot => {
                    const spotElement = document.querySelector(`[data-spot="${spot.id}"]`);
                    if (spotElement) {
                        // Update classes
                        spotElement.className = `vip-spot ${spot.status}`;
                        
                        // Update status text
                        const statusElement = spotElement.querySelector('.spot-status');
                        if (statusElement) {
                            statusElement.textContent = getVIPStatusText(spot.status);
                        }
                    }
                });
            }
            
            // Get status text in Vietnamese
            function getVIPStatusText(status) {
                const statusMap = {
                    'empty': 'Tr·ªëng',
                    'occupied': 'C√≥ xe',
                    'reserved': 'ƒê√£ ƒë·∫∑t'
                };
                return statusMap[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
            }
            
            // Add click handlers for VIP spots
            document.querySelectorAll('.vip-spot').forEach(spot => {
                spot.addEventListener('click', function() {
                    const spotId = this.dataset.spot;
                    const spotData = vipSpots.find(s => s.id === spotId);
                    
                    if (spotData && spotData.status === 'empty') {
                        // Select this spot for reservation
                        document.querySelectorAll('.vip-spot').forEach(s => s.classList.remove('selected'));
                        this.classList.add('selected');
                        
                        // Update form
                        document.getElementById('selected-spot').value = `Khu VIP - ${spotId}`;
                        document.getElementById('selected-spot-id').value = spotId;
                        
                        showToast('Th√¥ng b√°o', `ƒê√£ ch·ªçn ${spotId} - Khu VIP`, 'success');
                    } else {
                        showToast('L·ªói', `${spotId} kh√¥ng th·ªÉ ƒë·∫∑t ch·ªó`, 'error');
                    }
                });
            });
            
            // Update statistics
            function updateStats() {
                const totalSpots = vipSpots.length;
                const emptySpots = vipSpots.filter(s => s.status === 'empty').length;
                const occupiedSpots = vipSpots.filter(s => s.status === 'occupied').length;
                const reservedSpots = vipSpots.filter(s => s.status === 'reserved').length;
                
                document.getElementById('total-spots').textContent = totalSpots;
                document.getElementById('empty-spots').textContent = emptySpots;
                document.getElementById('occupied-spots').textContent = occupiedSpots;
                document.getElementById('reserved-spots').textContent = reservedSpots;
            }
            
            // Show toast notification
            function showToast(title, message, type = 'info') {
                const toast = document.getElementById('notification-toast');
                const toastTitle = document.getElementById('toast-title');
                const toastMessage = document.getElementById('toast-message');
                
                toastTitle.textContent = title;
                toastMessage.textContent = message;
                
                // Remove existing type classes
                toast.classList.remove('toast-success', 'toast-error', 'toast-warning');
                toast.classList.add(`toast-${type}`);
                
                const bsToast = new bootstrap.Toast(toast);
                bsToast.show();
            }
            
            // Handle reservation form
            document.getElementById('reservation-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const licensePlate = document.getElementById('license-plate').value;
                const spotId = document.getElementById('selected-spot-id').value;
                
                if (!spotId) {
                    showToast('L·ªói', 'Vui l√≤ng ch·ªçn v·ªã tr√≠ ƒë·ªó xe', 'error');
                    return;
                }
                
                // Update spot status to reserved
                const spot = vipSpots.find(s => s.id === spotId);
                if (spot) {
                    spot.status = 'reserved';
                    spot.license_plate = licensePlate;
                    
                    updateVIPDisplay();
                    updateStats();
                    
                    // Clear form
                    this.reset();
                    document.getElementById('selected-spot').value = '';
                    document.getElementById('selected-spot-id').value = '';
                    document.querySelectorAll('.vip-spot').forEach(s => s.classList.remove('selected'));
                    
                    showToast('Th√†nh c√¥ng', `ƒê√£ ƒë·∫∑t ch·ªó ${spotId} cho xe ${licensePlate}`, 'success');
                }
            });
            
            // Initialize display
            updateVIPDisplay();
            updateStats();
        });
        
        // Functions for buttons
        function refreshMap() {
            location.reload();
        }
        
        function toggleView() {
            alert('Ch·ª©c nƒÉng 3D View ƒëang ph√°t tri·ªÉn');
        }
    </script>
</body>
</html>